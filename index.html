<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<title>ZeroCost Cloud Group Chat</title>
<style>
body { font-family: Arial; background:#f4f4f4; padding:20px }
#chat {
  background:#fff;
  height:350px;
  overflow-y:auto;
  padding:10px;
  border:1px solid #ccc;
}
.msg { margin:6px 0 }
.system { color: gray; font-style: italic }
.me { color: green }
</style>
</head>
<body>

<h2>ZeroCost Cloud Group Chat</h2>

<input id="username" placeholder="Ismingni yoz">
<button onclick="join()">Join</button>

<div id="chat"></div>

<input id="text" placeholder="Xabar yoz..." style="width:70%">
<button onclick="send()">Send</button>

<script>
const chat = document.getElementById("chat");
const socket = new WebSocket("wss://echo.websocket.events");
let user = "";
let joined = false;

// yordamchi funksiya
function addMessage(html, cls="msg") {
  const div = document.createElement("div");
  div.className = cls;
  div.innerHTML = html;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

// Join
function join() {
  const name = document.getElementById("username").value.trim();
  if (!name) {
    alert("Iltimos, ismingni yoz");
    return;
  }
  user = name;
  joined = true;
  addMessage("Siz chatga a’zo bo‘ldingiz", "system");
}

// Send
function send() {
  if (!joined) {
    alert("Avval Join bosing");
    return;
  }
  const text = document.getElementById("text").value.trim();
  if (!text) return;

  const payload = {
    user,
    text
  };

  socket.send(JSON.stringify(payload));

  // o‘zing yuborgan xabarni darrov ko‘rsatamiz
  addMessage(`<b>Men:</b> ${text}`, "msg me");

  document.getElementById("text").value = "";
}

// Receive (echo server qaytaradi)
socket.onmessage = e => {
  try {
    const data = JSON.parse(e.data);

    // o‘zing yuborgan bo‘lsa – qayta chiqarmaymiz
    if (data.user === user) return;

    addMessage(`<b>${data.user}:</b> ${data.text}`);
  } catch {
    // boshqa echo xabarlarni e’tiborsiz qoldiramiz
  }
};
</script>

</body>
</html>
