<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ZeroCost Cloud Group Chat</title>
<style>
body { font-family: Arial; background:#f4f4f4; padding:20px }
#chat { background:#fff; height:350px; overflow-y:auto; padding:10px; border:1px solid #ccc }
.msg { margin:5px 0 }
button { margin-left:5px }
</style>
</head>
<body>

<h2>ZeroCost Cloud Group Chat</h2>

<input id="username" placeholder="Ismingni yoz" />
<button onclick="join()">Join</button>

<div id="chat"></div>

<input id="text" placeholder="Xabar yoz..." style="width:70%">
<button onclick="send()">Send</button>

<script>
const chat = document.getElementById("chat");
let user = "";
const socket = new WebSocket(
  "wss://demo.piesocket.com/v3/channel/group-chat-demo?api_key=demokey&notify_self=1"
);

function join() {
  user = document.getElementById("username").value || "Guest";
}

function send() {
  const text = document.getElementById("text").value;
  if (!text) return;
  const msg = {
    type: "new",
    id: Date.now(),
    user,
    text
  };
  socket.send(JSON.stringify(msg));
  document.getElementById("text").value = "";
}

socket.onmessage = e => {
  const data = JSON.parse(e.data);

  if (data.type === "new") {
    const div = document.createElement("div");
    div.className = "msg";
    div.id = data.id;
    div.innerHTML = `<b>${data.user}:</b> 
      <span>${data.text}</span>
      <button onclick="edit(${data.id})">Edit</button>
      <button onclick="del(${data.id})">Delete</button>`;
    chat.appendChild(div);
  }

  if (data.type === "edit") {
    const el = document.getElementById(data.id);
    if (el) el.querySelector("span").innerText = data.text;
  }

  if (data.type === "delete") {
    const el = document.getElementById(data.id);
    if (el) el.remove();
  }
};

function edit(id) {
  const newText = prompt("Yangi matn:");
  if (!newText) return;
  socket.send(JSON.stringify({
    type: "edit",
    id,
    text: newText
  }));
}

function del(id) {
  socket.send(JSON.stringify({
    type: "delete",
    id
  }));
}
</script>

</body>
</html>
